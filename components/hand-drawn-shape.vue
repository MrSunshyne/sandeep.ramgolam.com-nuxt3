<script setup lang="ts">
type ShapeVariant = 'rectangle' | 'pill' | 'card' | 'wide';

interface Props {
  variant?: ShapeVariant;
  selected?: boolean;
  color?: string;
  hoverMorph?: boolean;
  animated?: boolean;
  strokeWidth?: number;
}

const props = withDefaults(defineProps<Props>(), {
  variant: 'rectangle',
  selected: false,
  color: undefined,
  hoverMorph: true,
  animated: false,
  strokeWidth: 2.5,
});

// Shape definitions - each has a default path and a hover path
const shapes = {
  rectangle: {
    viewBox: '0 0 400 300',
    default: 'M10 5 Q5 4 3 7 Q1 10 2 15 L3 25 Q1 60 4 100 T2 160 Q4 200 3 240 T4 280 Q2 290 5 294 Q8 297 14 296 L25 295 Q80 297 140 295 T260 297 Q320 295 370 297 T392 295 Q396 295 398 291 Q400 287 398 280 L398 270 Q400 220 397 170 T400 110 Q397 70 398 35 T396 12 Q397 6 393 4 Q389 2 383 4 L365 5 Q300 3 240 5 T120 3 Q60 5 20 4 Z',
    hover: 'M8 2 Q3 1 1 5 Q-2 10 1 18 L2 30 Q-1 70 3 115 T-1 175 Q4 220 1 260 T5 290 Q2 296 6 298 Q10 300 18 298 L30 297 Q90 300 160 296 T280 300 Q340 296 385 299 T395 297 Q400 296 401 291 Q403 285 400 275 L401 260 Q403 210 398 155 T403 95 Q398 55 400 25 T397 8 Q398 3 392 1 Q386 -1 378 2 L355 3 Q280 6 210 2 T90 6 Q40 2 15 3 Z',
  },
  pill: {
    viewBox: '0 0 120 50',
    default: 'M8 4 Q3 3 2 8 Q1 12 2 20 T2 38 Q2 45 8 46 L15 46 Q35 47 60 46 T105 47 L112 46 Q117 45 118 40 Q119 35 118 25 T118 10 Q118 5 112 4 L100 4 Q75 3 50 4 T15 3 Z',
    hover: 'M6 3 Q2 2 1 7 Q0 13 1 22 T1 40 Q1 47 7 48 L18 47 Q40 49 62 47 T108 49 L114 48 Q119 47 120 42 Q121 36 120 26 T120 9 Q120 4 114 3 L95 4 Q70 2 45 4 T12 2 Z',
  },
  card: {
    viewBox: '0 0 400 300',
    default: 'M12 6 Q8 5 5 8 Q3 11 4 16 L4 18 Q2 50 5 80 T3 140 Q5 180 4 220 T5 270 Q3 285 5 290 Q6 294 10 295 L20 294 Q70 296 120 294 T220 296 Q280 294 340 296 T390 294 Q394 294 396 290 Q398 286 396 280 L397 270 Q395 230 397 190 T395 130 Q397 90 396 50 T397 16 Q398 10 394 7 Q390 4 385 5 L370 6 Q310 4 250 6 T130 4 Q70 6 20 5 Z',
    hover: 'M15 3 Q6 2 3 6 Q-1 12 2 20 L3 25 Q-2 60 4 95 T-1 160 Q6 200 2 240 T6 280 Q2 290 6 294 Q10 298 18 296 L30 297 Q80 292 140 298 T260 291 Q320 298 370 293 T392 297 Q398 296 399 290 Q402 284 398 275 L399 265 Q402 220 395 175 T402 115 Q394 75 399 40 T395 12 Q396 5 390 3 Q384 0 375 3 L360 4 Q290 8 220 2 T100 7 Q50 2 25 4 Z',
  },
  wide: {
    viewBox: '0 0 756 378',
    default: 'M750.306 233.978C746.334 251.867 756.832 283.585 748.744 290.631C745.786 293.207 743.368 297.439 743.368 300.038C743.368 302.638 742.066 304.765 740.474 304.765C738.882 304.765 737.579 306.114 737.579 307.764C737.579 310.896 734.05 319.052 717.552 336C704.037 349.883 677.046 341.079 671.832 341.079C669.377 341.079 667.368 342.382 667.368 343.974C667.368 345.566 662.809 346.869 657.237 346.869C651.665 346.869 647.105 348.171 647.105 349.763C647.105 351.396 638.904 352.658 628.289 352.658C617.674 352.658 609.474 353.92 609.474 355.553C609.474 357.182 601.351 358.447 590.898 358.447C578.619 358.447 571.912 359.672 571.11 362.065C570.16 364.894 568.215 364.789 562.208 361.591C556.132 358.355 552.974 358.201 547.124 360.867C543.057 362.72 527.978 364.237 513.62 364.237C498.993 364.237 484.734 365.745 481.191 367.667C475.647 370.671 341.821 374.353 247.632 374.093C211.552 373.991 145.19 369.482 139.994 366.775C137.31 365.38 130.473 364.237 124.796 364.237C119.12 364.237 114.474 362.934 114.474 361.342C114.474 359.75 110.566 358.447 105.79 358.447C101.013 358.447 97.1053 357.145 97.1053 355.553C97.1053 353.96 93.8487 352.658 89.8685 352.658C85.8882 352.658 82.6317 351.355 82.6317 349.763C82.6317 348.171 80.0264 346.869 76.8422 346.869C73.658 346.869 71.0527 345.566 71.0527 343.974C71.0527 342.382 69.1219 341.079 66.7656 341.079C61.1035 341.079 27.6317 307.701 27.6317 302.057C27.6317 299.637 26.5606 297.66 25.2521 297.66C22.0911 297.66 11.3053 272.783 8.93451 260.029C8.93451 233.127 11.6953 241.361 9.89477 241.361C8.16951 241.361 7.00006 230.265 7.00006 213.861C7.00006 197.457 2.16951 165.362 3.89477 165.362C5.48688 165.362 6.78955 142.881 6.78955 137.402C6.78955 131.922 8.09216 126.636 9.68427 125.652C11.2764 124.668 12.579 117.472 12.579 109.659C12.579 96.5554 19.7811 74.8515 24.8817 72.585C26.0743 72.0523 27.0527 69.1232 27.0527 66.0722C27.0527 63.0184 29.3553 62.5232 30.9474 62.5232C32.5396 62.5232 33.8422 60.5056 33.8422 58.0422C33.8422 52.2588 60.4753 32.3143 66.2098 32.3143C68.6095 32.3143 71.0034 33.2288 71.5361 31.9059C72.9053 28.4845 102.791 28.5378 112.303 26.1498C116.68 25.0498 120.263 22.873 120.263 21.3128C120.263 19.7497 124.744 18.4732 130.224 18.4732C135.704 18.4732 140.99 17.1706 141.974 15.5786C142.958 13.9865 149.546 12.6839 156.618 12.6839C163.69 12.6839 169.474 11.3813 169.474 9.78927C169.474 8.02064 182.984 6.89463 204.211 6.89463C225.438 6.89463 238.947 5.76862 238.947 4C247.704 4 623.947 8.19722 623.947 9.78927C623.947 11.3813 626.229 12.6984 629.013 12.7187C631.798 12.7389 639.672 15.9519 646.509 19.8597C657.335 26.0485 692.168 26.3727 693.705 22.3665C695.187 18.505 706.316 8.86684 710.751 14.633C713.654 18.4105 716.06 22.6048 716.094 23.9566C716.129 25.3084 720.066 30.0643 724.842 34.525C729.619 38.9856 733.538 43.7416 717.552 45.0934C717.564 46.4452 722.123 52.3473 727.684 58.2118C733.242 64.0764 737.789 70.9164 737.789 73.4087C737.789 75.9039 739.092 77.9446 740.684 77.9446C742.276 77.9446 726.579 80.5498 726.579 83.7339C726.579 86.918 727.882 89.5232 729.474 89.5232C731.066 89.5232 732.368 92.7796 732.368 96.7598C732.368 100.74 733.437 103.996 734.739 103.996C736.045 103.996 738.908 110.593 741.102 118.652C743.299 126.713 736.139 143.956 737.415 144.743C738.692 145.533 739.751 152.941 739.769 161.205C739.786 169.469 741.786 182.744 744.218 190.704C746.962 199.698 748.676 216.956 748.745 236.295',
    hover: 'M754.055 226.512C750.084 244.401 759.581 276.119 751.493 283.165C748.535 285.741 746.118 289.973 746.118 291.573C746.118 294.172 744.815 296.299 743.223 296.299C741.631 296.299 740.329 297.648 740.329 299.298C740.329 302.43 731.997 291.552 715.5 308.5C701.985 322.383 680 319 674.582 332.614C672.127 332.614 659.986 331.022 659.986 332.614C659.986 334.206 665.559 338.403 659.986 338.403C654.414 338.403 626.697 342.6 626.697 344.192C626.697 345.825 618.496 347.087 607.881 347.087C597.266 347.087 589.065 348.349 589.065 349.982C589.065 351.611 580.943 352.876 570.49 352.876C558.21 352.876 551.503 354.101 550.701 356.494C549.752 359.323 547.807 359.218 541.8 356.02C535.724 352.784 532.566 352.63 526.716 355.296C522.649 357.149 507.57 358.665 493.212 358.665C454.75 358.665 463.648 357.279 460.105 359.201C454.561 362.206 361.189 327.795 267 327.534C230.92 327.433 147.939 361.016 142.743 358.309C140.06 356.914 133.223 355.771 127.546 355.771C121.869 355.771 117.223 354.468 117.223 352.876C117.223 351.284 113.316 349.982 108.539 349.982C103.763 349.982 99.855 348.679 99.855 347.087C99.855 345.495 96.5984 344.192 92.6181 344.192C88.6379 344.192 85.3813 342.89 85.3813 341.298C85.3813 339.706 82.776 337.403 79.5918 337.403C76.4076 337.403 73.8023 336.1 73.8023 334.508C73.8023 332.916 71.8716 331.614 69.5153 331.614C63.8531 331.614 30.3813 298.236 30.3813 292.591C30.3813 290.171 29.3102 288.194 28.0018 288.194C24.8407 288.194 15.055 263.318 12.6842 250.564C12.6842 223.661 15.445 231.895 13.6444 231.895C11.9192 231.895 7.10531 207.9 7.10531 191.496C7.10531 175.092 2.1427 211.5 16.5001 156C-2.99997 125 6.8948 120.516 6.8948 115.036C6.8948 109.557 8.19741 104.271 9.78952 103.287C11.3816 102.303 12.6842 95.1067 12.6842 87.2941C12.6842 74.19 23.5308 65.3858 28.6313 63.1193C29.8239 62.5866 30.8023 59.6575 30.8023 56.6065C30.8023 53.5527 33.105 53.0575 34.6971 53.0575C36.2892 53.0575 37.5918 51.0399 37.5918 48.5765C37.5918 42.7931 69.0679 35.8137 74.8023 35.8137C77.2021 35.8137 79.596 36.7282 80.1286 35.4053C81.4978 31.9839 103.383 33.0372 112.895 30.6491C117.272 29.5492 121.856 27.3724 121.856 25.8122C121.856 24.2491 126.337 22.9726 131.817 22.9726C137.296 22.9726 142.582 21.67 143.566 20.0779C144.551 18.4859 151.139 17.1833 158.211 17.1833C165.283 17.1833 171.066 15.8807 171.066 14.2887C171.066 12.52 184.576 11.394 205.803 11.394C227.03 11.394 284.5 23.0957 337.5 35.8139C367.5 35.8139 599.25 9.80196 599.25 11.394C599.25 12.9861 630.978 4.2327 633.763 4.25296C651.259 4.38027 644.421 7.48625 651.259 11.394C662.085 17.5828 696.917 17.907 698.454 13.9008C699.936 10.0393 711.065 1.40115 715.5 7.16727C718.403 10.9448 720.809 15.1391 720.844 16.4909C720.879 17.8427 724.815 22.5986 729.592 27.0593C734.368 31.5199 737.287 36.2759 721.302 37.6277C721.314 38.9795 725.873 44.8816 731.434 50.7461C736.991 56.6107 741.539 63.4507 741.539 65.943C741.539 68.4382 742.842 70.4789 744.434 70.4789C746.026 70.4789 730.329 73.0841 730.329 76.2682C730.329 79.4523 731.631 82.0575 733.223 82.0575C734.815 82.0575 736.118 85.3139 736.118 89.2941C736.118 93.2742 741.712 119.688 743.015 119.688C744.32 119.688 747.183 126.284 749.377 134.343C751.574 142.405 744.414 159.647 745.691 160.434C746.967 161.225 748.027 168.632 748.044 176.896C748.062 185.16 737.897 199.54 740.329 207.5C743.073 216.494 752.425 209.49 752.495 228.829',
  },
};

const currentShape = computed(() => shapes[props.variant]);
</script>

<template>
  <svg
    class="hand-drawn-shape"
    :class="[
      `variant-${variant}`,
      { selected, 'hover-morph': hoverMorph, animated }
    ]"
    :style="{ '--shape-stroke-color': color || 'currentColor' }"
    :viewBox="currentShape.viewBox"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
    preserveAspectRatio="none"
  >
    <path
      class="shape-path"
      :stroke="color || 'currentColor'"
      :stroke-width="strokeWidth"
      stroke-linecap="round"
      stroke-linejoin="round"
      :d="currentShape.default"
      :data-hover-path="currentShape.hover"
    />
  </svg>
</template>

<style scoped>
.hand-drawn-shape {
  position: absolute;
  inset: -2px;
  width: calc(100% + 4px);
  height: calc(100% + 4px);
  z-index: 0;
  pointer-events: none;
}

.shape-path {
  fill: transparent;
  transition: color 0.4s ease-out, fill 0.4s ease-out, d 0.4s ease-out, stroke 0.4s ease-out;
  fill-opacity: 0.0;
}

/* Selected state - filled background */
.selected .shape-path {
  /*fill: var(--shape-stroke-color, currentColor);*/
  fill-opacity: 0.12;
}

/* Draw animation for animated variant */
.animated .shape-path {
  stroke-dasharray: 2000;
  stroke-dashoffset: 2000;
}

.animated.is-visible .shape-path {
  animation: draw-shape 1s ease-out forwards;
}

@keyframes draw-shape {
  to {
    stroke-dashoffset: 0;
  }
}
</style>

<style>
/* Global hover morph styles (not scoped so parent can trigger) */
.hover-morph.variant-rectangle:hover .shape-path,
.hover-morph.variant-rectangle.is-hovered .shape-path,
*:hover > .hover-morph.variant-rectangle .shape-path {
  d: path("M8 2 Q3 1 1 5 Q-2 10 1 18 L2 30 Q-1 70 3 115 T-1 175 Q4 220 1 260 T5 290 Q2 296 6 298 Q10 300 18 298 L30 297 Q90 300 160 296 T280 300 Q340 296 385 299 T395 297 Q400 296 401 291 Q403 285 400 275 L401 260 Q403 210 398 155 T403 95 Q398 55 400 25 T397 8 Q398 3 392 1 Q386 -1 378 2 L355 3 Q280 6 210 2 T90 6 Q40 2 15 3 Z");
}

.hover-morph.variant-pill:hover .shape-path,
.hover-morph.variant-pill.is-hovered .shape-path,
*:hover > .hover-morph.variant-pill .shape-path {
  d: path("M6 3 Q2 2 1 7 Q0 13 1 22 T1 40 Q1 47 7 48 L18 47 Q40 49 62 47 T108 49 L114 48 Q119 47 120 42 Q121 36 120 26 T120 9 Q120 4 114 3 L95 4 Q70 2 45 4 T12 2 Z");
}

.hover-morph.variant-card:hover .shape-path,
.hover-morph.variant-card.is-hovered .shape-path,
*:hover > .hover-morph.variant-card .shape-path {
  d: path("M15 3 Q6 2 3 6 Q-1 12 2 20 L3 25 Q-2 60 4 95 T-1 160 Q6 200 2 240 T6 280 Q2 290 6 294 Q10 298 18 296 L30 297 Q80 292 140 298 T260 291 Q320 298 370 293 T392 297 Q398 296 399 290 Q402 284 398 275 L399 265 Q402 220 395 175 T402 115 Q394 75 399 40 T395 12 Q396 5 390 3 Q384 0 375 3 L360 4 Q290 8 220 2 T100 7 Q50 2 25 4 Z");
}

.hover-morph.variant-wide:hover .shape-path,
.hover-morph.variant-wide.is-hovered .shape-path,
*:hover > .hover-morph.variant-wide .shape-path {
  d: path("M754.055 226.512C750.084 244.401 759.581 276.119 751.493 283.165C748.535 285.741 746.118 289.973 746.118 291.573C746.118 294.172 744.815 296.299 743.223 296.299C741.631 296.299 740.329 297.648 740.329 299.298C740.329 302.43 731.997 291.552 715.5 308.5C701.985 322.383 680 319 674.582 332.614C672.127 332.614 659.986 331.022 659.986 332.614C659.986 334.206 665.559 338.403 659.986 338.403C654.414 338.403 626.697 342.6 626.697 344.192C626.697 345.825 618.496 347.087 607.881 347.087C597.266 347.087 589.065 348.349 589.065 349.982C589.065 351.611 580.943 352.876 570.49 352.876C558.21 352.876 551.503 354.101 550.701 356.494C549.752 359.323 547.807 359.218 541.8 356.02C535.724 352.784 532.566 352.63 526.716 355.296C522.649 357.149 507.57 358.665 493.212 358.665C454.75 358.665 463.648 357.279 460.105 359.201C454.561 362.206 361.189 327.795 267 327.534C230.92 327.433 147.939 361.016 142.743 358.309C140.06 356.914 133.223 355.771 127.546 355.771C121.869 355.771 117.223 354.468 117.223 352.876C117.223 351.284 113.316 349.982 108.539 349.982C103.763 349.982 99.855 348.679 99.855 347.087C99.855 345.495 96.5984 344.192 92.6181 344.192C88.6379 344.192 85.3813 342.89 85.3813 341.298C85.3813 339.706 82.776 337.403 79.5918 337.403C76.4076 337.403 73.8023 336.1 73.8023 334.508C73.8023 332.916 71.8716 331.614 69.5153 331.614C63.8531 331.614 30.3813 298.236 30.3813 292.591C30.3813 290.171 29.3102 288.194 28.0018 288.194C24.8407 288.194 15.055 263.318 12.6842 250.564C12.6842 223.661 15.445 231.895 13.6444 231.895C11.9192 231.895 7.10531 207.9 7.10531 191.496C7.10531 175.092 2.1427 211.5 16.5001 156C-2.99997 125 6.8948 120.516 6.8948 115.036C6.8948 109.557 8.19741 104.271 9.78952 103.287C11.3816 102.303 12.6842 95.1067 12.6842 87.2941C12.6842 74.19 23.5308 65.3858 28.6313 63.1193C29.8239 62.5866 30.8023 59.6575 30.8023 56.6065C30.8023 53.5527 33.105 53.0575 34.6971 53.0575C36.2892 53.0575 37.5918 51.0399 37.5918 48.5765C37.5918 42.7931 69.0679 35.8137 74.8023 35.8137C77.2021 35.8137 79.596 36.7282 80.1286 35.4053C81.4978 31.9839 103.383 33.0372 112.895 30.6491C117.272 29.5492 121.856 27.3724 121.856 25.8122C121.856 24.2491 126.337 22.9726 131.817 22.9726C137.296 22.9726 142.582 21.67 143.566 20.0779C144.551 18.4859 151.139 17.1833 158.211 17.1833C165.283 17.1833 171.066 15.8807 171.066 14.2887C171.066 12.52 184.576 11.394 205.803 11.394C227.03 11.394 284.5 23.0957 337.5 35.8139C367.5 35.8139 599.25 9.80196 599.25 11.394C599.25 12.9861 630.978 4.2327 633.763 4.25296C651.259 4.38027 644.421 7.48625 651.259 11.394C662.085 17.5828 696.917 17.907 698.454 13.9008C699.936 10.0393 711.065 1.40115 715.5 7.16727C718.403 10.9448 720.809 15.1391 720.844 16.4909C720.879 17.8427 724.815 22.5986 729.592 27.0593C734.368 31.5199 737.287 36.2759 721.302 37.6277C721.314 38.9795 725.873 44.8816 731.434 50.7461C736.991 56.6107 741.539 63.4507 741.539 65.943C741.539 68.4382 742.842 70.4789 744.434 70.4789C746.026 70.4789 730.329 73.0841 730.329 76.2682C730.329 79.4523 731.631 82.0575 733.223 82.0575C734.815 82.0575 736.118 85.3139 736.118 89.2941C736.118 93.2742 741.712 119.688 743.015 119.688C744.32 119.688 747.183 126.284 749.377 134.343C751.574 142.405 744.414 159.647 745.691 160.434C746.967 161.225 748.027 168.632 748.044 176.896C748.062 185.16 737.897 199.54 740.329 207.5C743.073 216.494 752.425 209.49 752.495 228.829");
}
</style>
